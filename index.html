<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>RUINACOIN</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { background:#0f0f0f; color:#fff; font-family:Arial, sans-serif; text-align:center; padding:20px; margin:0; }
#playerId { position:fixed; top:10px; left:10px; background:#1a1a1a; padding:8px 12px; border-radius:8px; color:#00ffd5; font-weight:bold; font-size:16px; box-shadow:0 0 10px #00ffd5; z-index:9999; cursor:pointer; }
h1 { font-size:32px; color:#ff00aa; margin-bottom:10px; text-shadow:0 0 10px #ff00aa; }
#score { font-size:24px; margin-bottom:10px; }
#clickPowerDisplay { font-size:20px; color:#00ffd5; margin-bottom:20px; }
.tap-image { width:80%; max-width:300px; height:auto; cursor:pointer; border-radius:20px; box-shadow:0 0 20px #ff00aa; transition:transform .1s ease; }
.tap-image:active { transform:scale(.97); }
.shop { margin-top:30px; }
.shop h2 { font-size:20px; margin-bottom:10px; color:#00ffd5; }
.shop-button { font-size:16px; margin:8px; padding:10px 20px; background:#222; color:#fff; border:2px solid #00ffd5; border-radius:10px; cursor:pointer; transition:all .2s ease; }
.shop-button:hover { background:#333; transform:scale(1.05); }
#message { margin-top:20px; font-size:18px; color:#ffcc00; min-height:24px; white-space:pre-line; }
#skins { display:flex; flex-wrap:wrap; justify-content:center; }
.skin-button { display:inline-block; margin:10px; border:2px solid #00ffd5; border-radius:12px; cursor:pointer; padding:8px; background:#111; transition:all .3s ease; max-width:160px; text-align:center; }
.skin-button:hover { background:#222; transform:scale(1.05); }
.skin-img { max-width:100%; border-radius:10px; display:block; margin:0 auto 6px; box-shadow:0 0 10px #00ffd5; }
.skin-info { color:#00ffd5; font-size:14px; font-weight:bold; }
.selected-badge { display:inline-block; margin-top:6px; padding:4px 8px; background:#00ffd5; color:#000; border-radius:8px; font-weight:bold; font-size:12px; }
#topStatsContainer { margin-top:40px; text-align:left; max-width:400px; margin-left:auto; margin-right:auto; }
</style>
</head>
<body>

<div id="playerId">ID: ??????</div>

<h1>RUINACOIN TAP</h1>
<div id="score">RUINA: 0</div>
<div id="clickPowerDisplay">Click Power: +1</div>

<img id="tapButton" src="https://i.postimg.cc/BnNsnqwB/photo-5321361869136590759-y-removebg-preview.png" class="tap-image" alt="tap">

<div class="shop">
<h2>Upgrade Shop</h2>
<button class="shop-button" id="buyUpgradeBtn">Add +1 per click — <span id="upgradeCost">50</span> RUINA</button>
<button class="shop-button" id="buyAutoClickBtn">Auto Click (lvl <span id="autoClickLevel">0</span>) — <span id="autoClickCost">20000</span> RUINA</button>
<button class="shop-button" id="topStatsBtn">Показать топ RUINA</button>
</div>

<div class="shop">
<h2>Skin Shop</h2>
<div id="skins"></div>
</div>

<div id="message"></div>
<div id="topStatsContainer"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>

<script>
// ==================== FIREBASE ИНИЦИАЛИЗАЦИЯ ====================
const firebaseConfig = {
  apiKey: "AIzaSyCTPqupywSBU4S5inETk8p-tQFMe3Dx4tE",
  authDomain: "coin-2e819.firebaseapp.com",
  databaseURL: "https://coin-2e819-default-rtdb.firebaseio.com",
  projectId: "coin-2e819",
  storageBucket: "coin-2e819.firebasestorage.app",
  messagingSenderId: "701106957724",
  appId: "1:701106957724:web:dfba4d3ce63521afb1ec59"
};
firebase.initializeApp(firebaseConfig);

// ==================== DATABASE ADAPTER ====================
const dbAdapter = {
    async setPlayer(id, payload) {
        return firebase.database().ref("players/" + id).set(payload);
    },
    async getAllPlayers() {
        const snapshot = await firebase.database().ref("players").once("value");
        return snapshot.val() || {};
    },
    async getPlayer(id) {
        const snapshot = await firebase.database().ref("players/" + id).once("value");
        return snapshot.val() || null;
    }
};

// ==================== ИГРОВЫЕ ДАННЫЕ ====================
let ruina = 0, baseClick = 1, baseAuto = 0;
let upgradeCost = 50, autoClickCost = 20000;
let selectedSkin = 1, autoInterval = null, playerID = null;
let purchasedSkins = [];

// ==================== СКИНЫ ====================
const skins = [
{id:1,name:"Default",img:"https://i.postimg.cc/BnNsnqwB/photo-5321361869136590759-y-removebg-preview.png",cost:0},
{id:2,name:"Skin 1",cost:10000,img:"https://i.postimg.cc/d7hZXDtL/photo-1-2025-09-16-13-48-10.jpg",bonus:{clickMult:1.1,autoMult:1}},
{id:3,name:"Skin 2",cost:25000,img:"https://i.postimg.cc/4HgKm5v9/photo-2-2025-09-16-13-48-10.jpg",bonus:{clickMult:1.25,autoMult:1}},
{id:4,name:"Skin 3",cost:50000,img:"https://i.postimg.cc/0MmMk3Sv/photo-3-2025-09-16-13-48-10.jpg",bonus:{clickMult:1.5,autoMult:1}},
{id:5,name:"Skin 4",cost:120000,img:"https://i.postimg.cc/RJLWfHGb/photo-4-2025-09-16-13-48-10.jpg",bonus:{clickMult:1,autoMult:2}},
{id:6,name:"Skin 5",cost:350000,img:"https://i.postimg.cc/7CjJyDfX/photo-5-2025-09-16-13-48-10.jpg",bonus:{clickMult:1,autoMult:3}},
{id:7,name:"Skin 6",cost:700000,img:"https://i.postimg.cc/0rYMhTxd/photo-6-2025-09-16-13-48-10.jpg",bonus:{clickMult:3,autoMult:3}}
];

// ==================== ИНИЦИАЛИЗАЦИЯ ИГРОКА ====================
function generateID(){ return String(Math.floor(100000+Math.random()*900000)); }

function loadOrCreatePlayerID(){
    let id = localStorage.getItem("playerID");
    if(!id){ id = generateID(); localStorage.setItem("playerID", id); }
    return id;
}

async function loadPlayer(){
    playerID = loadOrCreatePlayerID();
    document.getElementById("playerId").innerText = "ID: " + playerID;

    // Загружаем данные с Firebase
    const saved = await dbAdapter.getPlayer(playerID) || {};

    baseClick = saved.baseClick ?? 1;
    baseAuto = saved.baseAuto ?? 0;
    upgradeCost = saved.upgradeCost ?? 50;
    autoClickCost = saved.autoClickCost ?? 20000;
    selectedSkin = saved.selectedSkin ?? 1;
    purchasedSkins = saved.purchasedSkins ?? [1];
    ruina = saved.ruina ?? 0;

    const skin = skins.find(s => s.id === selectedSkin);
    document.getElementById("tapButton").src = skin.img;

    updateUI();
    updateSkins();

    if(baseAuto > 0) startAutoClick();
}

async function savePlayer(){
    // Локальный кэш
    localStorage.setItem("ruinaData_"+playerID, JSON.stringify({
        ruina, baseClick, baseAuto, upgradeCost, autoClickCost, selectedSkin, purchasedSkins
    }));

    // Сохраняем на Firebase
    await dbAdapter.setPlayer(playerID, {
        ruina, baseClick, baseAuto, upgradeCost, autoClickCost, selectedSkin, purchasedSkins,
        updatedAt: Date.now()
    });
}

// ==================== UI ====================
function updateUI(){
    document.getElementById("score").innerText = "RUINA: " + Math.round(ruina);
    document.getElementById("clickPowerDisplay").innerText = "Click Power: +" + baseClick;
    document.getElementById("upgradeCost").innerText = upgradeCost;
    document.getElementById("autoClickLevel").innerText = baseAuto;
    document.getElementById("autoClickCost").innerText = autoClickCost;
}

// ==================== КЛИК ====================
function tap(){
    let mult = 1;
    const skin = skins.find(s => s.id === selectedSkin);
    if(skin?.bonus?.clickMult) mult = skin.bonus.clickMult;

    ruina += baseClick * mult;
    updateUI();
    savePlayer();
}

document.getElementById("tapButton").addEventListener("click", tap);

// ==================== АВТОКЛИК ====================
function startAutoClick(){
    if(autoInterval) clearInterval(autoInterval);
    autoInterval = setInterval(()=>{
        let mult = 1;
        const skin = skins.find(s => s.id === selectedSkin);
        if(skin?.bonus?.autoMult) mult = skin.bonus.autoMult;

        ruina += baseAuto * mult;
        updateUI();
        savePlayer();
    }, 1000);
}

// ==================== ПОКУПКИ ====================
document.getElementById("buyUpgradeBtn").addEventListener("click", ()=>{
    if(ruina < upgradeCost) return showMsg("Not enough RUINA!");
    ruina -= upgradeCost;
    baseClick++;
    upgradeCost = Math.floor(upgradeCost * 1.5);
    showMsg("Click power upgraded!");
    updateUI(); savePlayer();
});

document.getElementById("buyAutoClickBtn").addEventListener("click", ()=>{
    if(ruina < autoClickCost) return showMsg("Not enough RUINA!");
    ruina -= autoClickCost;
    baseAuto++;
    autoClickCost = Math.floor(autoClickCost * 2.5);
    showMsg("Auto click upgraded!");
    startAutoClick();
    updateUI(); savePlayer();
});

// ==================== СКИНЫ ====================
function updateSkins(){
    const container = document.getElementById("skins");
    container.innerHTML = "";

    skins.forEach(s=>{
        const owned = purchasedSkins.includes(s.id);

        const btn = document.createElement("div");
        btn.className = "skin-button";
        btn.innerHTML = `
            <img src="${s.img}" class="skin-img" style="${selectedSkin===s.id ? 'border:2px solid #ff00aa;box-shadow:0 0 20px #ff00aa;' : ''}">
            <div class="skin-info">${s.name}<br>${owned ? "OWNED" : s.cost + " RUINA"}</div>
            ${selectedSkin===s.id ? '<div class="selected-badge">SELECTED</div>' : ''}
        `;

        btn.onclick = ()=>{
            if(!owned){
                if(ruina < s.cost) return showMsg("Not enough RUINA!");
                ruina -= s.cost;
                purchasedSkins.push(s.id);
            }
            selectedSkin = s.id;
            document.getElementById("tapButton").src = s.img;
            updateUI(); updateSkins(); savePlayer();
        };

        container.appendChild(btn);
    });
}

// ==================== СООБЩЕНИЯ ====================
let msgTimeout = null;
function showMsg(text,t=2000){
    const m=document.getElementById("message");
    m.innerText=text;
    if(msgTimeout) clearTimeout(msgTimeout);
    msgTimeout=setTimeout(()=>m.innerText="",t);
}

// ==================== ТОП ИГРОКОВ ====================
document.getElementById("topStatsBtn").addEventListener("click", async ()=>{
    const data = await dbAdapter.getAllPlayers();

    const players = Object.entries(data).map(([id,p])=>({
        id,
        ruina: Number(p?.ruina || 0)
    })).sort((a,b)=>b.ruina - a.ruina);

    const container = document.getElementById("topStatsContainer");
    container.innerHTML = "<h2>Топ RUINA:</h2>";

    players.slice(0,10).forEach((p,i)=>{
        container.innerHTML += `${i+1}. ID ${p.id}: ${Math.round(p.ruina)}<br>`;
    });

    container.scrollIntoView({behavior:"smooth"});
});

// ==================== СТАРТ ====================
window.addEventListener("beforeunload", ()=>{ try{ savePlayer(); }catch(e){} });
loadPlayer();
</script>
</body>
</html>
